<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="viewport" content="width=device-width" />
    <meta charset="utf-8" />
    <title>KMS ADMIN CONSOLE</title>
    <meta name="description" content="KEY Management Service(KMS)" />
    <link rel="icon" href="/favicon.ico" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-0evHe/X+R7YkIZDRvuzKMRqM+OrBnVFBL6DOitfPri4tjfHxaWutUpFmBp4vmVor"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="./login.css" />
  </head>
  <body>
    <script>
      const module = {};
      window.qs = (selector) => document.querySelector(selector);
      window.qsa = (selector) => document.querySelectorAll(selector);
    </script>
    <div
      class="container d-flex justify-content-center align-items-center vh-100"
    >
      <div
        class="row d-flex justify-content-center align-items-center h-100 w-100"
      >
        <div class="card col-md-8 col-lg-6 col-xl-4 offset-xl-1">
          <!-- Pills navs -->
          <div class="card-body mt-4">
            <h3 class="mb-4 fw-bold title">KMS ADMIN CONSOLE</h3>
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link active"
                  id="pills-Login-tab"
                  data-bs-toggle="pill"
                  data-bs-target="#pills-login"
                  type="button"
                  role="tab"
                  aria-controls="pills-Login"
                  aria-selected="true"
                >
                  Login
                </button>
              </li>
              <li class="nav-item" role="presentation">
                <button
                  class="nav-link"
                  id="pills-register-tab"
                  data-bs-toggle="pill"
                  data-bs-target="#pills-register"
                  type="button"
                  role="tab"
                  aria-controls="pills-register"
                  aria-selected="false"
                >
                  Register
                </button>
              </li>
            </ul>
            <!-- Pills navs -->

            <!-- Pills content -->
            <div class="tab-content">
              <div
                class="tab-pane fade show active"
                id="pills-login"
                role="tabpanel"
                aria-labelledby="pills-login"
              >
                <form>
                  <!-- Username input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="text"
                      id="loginUserId"
                      class="form-control"
                      placeholder=""
                      data-name="userId"
                    />
                    <label class="form-label" for="loginUserId">User id</label>
                  </div>

                  <!-- Password input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="password"
                      id="loginPassword"
                      class="form-control"
                      placeholder=""
                      data-name="password"
                    />
                    <label class="form-label" for="loginPassword"
                      >Password</label
                    >
                  </div>
                  <!-- Submit button -->
                  <button
                    id="loginSubmit"
                    type="button"
                    class="btn btn-primary btn-block mb-4"
                  >
                    Login
                  </button>
                </form>
              </div>
              <div
                class="tab-pane fade"
                id="pills-register"
                role="tabpanel"
                aria-labelledby="pills-register"
              >
                <form>
                  <!-- User id input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="text"
                      id="registerUserId"
                      class="form-control"
                      placeholder=""
                      data-name="userId"
                    />
                    <label class="form-label" for="registerUserId"
                      >User id</label
                    >
                  </div>

                  <!-- Name input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="text"
                      id="registerName"
                      class="form-control"
                      placeholder=""
                      data-name="name"
                    />
                    <label class="form-label" for="registerName">Name</label>
                  </div>

                  <!-- Email input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="email"
                      id="registerEmail"
                      class="form-control"
                      placeholder=""
                      data-name="email"
                    />
                    <label class="form-label" for="registerEmail">Email</label>
                  </div>

                  <!-- Password input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="password"
                      id="registerPassword"
                      class="form-control"
                      placeholder=""
                      data-name="password"
                    />
                    <label class="form-label" for="registerPassword"
                      >Password</label
                    >
                  </div>

                  <!-- Repeat Password input -->
                  <div class="form-floating form-outline mb-4">
                    <input
                      type="password"
                      id="registerRepeatPassword"
                      class="form-control"
                      placeholder=""
                      data-name="repeatPassword"
                    />
                    <label class="form-label" for="registerRepeatPassword"
                      >Repeat password</label
                    >
                  </div>

                  <!-- Checkbox -->
                  <div class="form-check mb-4">
                    <input
                      class="form-check-input me-2"
                      type="checkbox"
                      value=""
                      id="registerCheck"
                      checked
                      aria-describedby="registerCheckHelpText"
                      data-name="check"
                    />
                    <label class="form-check-label" for="registerCheck">
                      I have read and agree to the terms
                    </label>
                  </div>

                  <!-- Submit button -->
                  <button
                    id="registerSubmit"
                    type="button"
                    class="btn btn-primary btn-block mb-3"
                  >
                    Register
                  </button>
                </form>
              </div>
            </div>
          </div>
          <!-- Pills content -->
        </div>
      </div>
    </div>
    <script type="module">
      import { login, register } from "./login.js";
      module.login = login;
      module.register = register;
    </script>
    <script>
      var tmp;

      function loginCallback(data) {
        if (data.success) {
          window.location.href = "./index.html";
        } else {
          alert(data.message);
          if (data.target) {
            qs(data.target).focus();
          }
        }
      }

      function isEmpty(ctx) {
        if (ctx && ctx.value) {
          return true;
        }
        ctx.focus();
        return false;
      }

      async function login() {
        const userIdInput = qs("#loginUserId");
        const passInput = qs("#loginPassword");
        const userId = loginUserId.value;
        const password = loginPassword.value;
        if (!isEmpty(userIdInput) || !isEmpty(passInput)) return;
        const result = await module.login({ userId, password }, loginCallback);
      }

      async function register() {
        const ctxs = qsa('input[id*="register"]');
        const data = { target: {} };
        for (x of ctxs) {
          const name = x.dataset.name;
          if (name === "check") {
            if (x.checked === false) {
              x.value = "";
              alert("You must agree to the terms");
              return;
            }
            x.value = x.checked;
          }
          data[name] = x.value;
          data.target[name] = `#${x.id}`;
          if (!isEmpty(x)) return;
        }
        tmp = data;
        const result = await module.register(data, loginCallback);
      }

      qs("#loginSubmit").addEventListener("click", login);
      qs("#registerSubmit").addEventListener("click", register);
    </script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0-beta1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-pprn3073KE6tl6bjs2QrFaJGz5/SUsLqktiwsUTF55Jfv3qYSDhgCecCxMW52nD2"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
